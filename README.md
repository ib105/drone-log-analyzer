# Drone Flight Analyzer

A comprehensive drone flight data analysis tool that parses ArduPilot .BIN telemetry files, detects anomalies, and provides AI-powered insights using OpenAI's GPT-5 model.

## Features

- Parse ArduPilot .BIN telemetry files
- Real-time anomaly detection (voltage sags, vibration spikes, motor imbalances)
- Interactive data visualization with Plotly
- AI-powered flight analysis using GPT-5
- Downloadable technical reports

## Installation

### Prerequisites

- Python 3.12 or higher
- OpenAI API key

### Setup

1. Clone the repository:
```bash
git clone [<repository-url>](https://github.com/ib105/drone-log-analyzer/)
cd drone-analyzer
```

2. Install dependencies:
```bash
pip install -r requirements.txt
```

3. Configure your OpenAI API key:
   - Open `main.py`
   - Replace `"YOUR_API_KEY"` with your actual OpenAI API key:
   ```python
   client = OpenAI(api_key="your-actual-api-key-here")
   ```

## How to Run the Project

1. Start the Streamlit application:
```bash
streamlit run main.py
```

2. Open your web browser and navigate to the URL shown in the terminal (typically `http://localhost:8501`)

3. Upload a .BIN file using the file uploader

4. Click the "Analyze" button to process the flight data

5. View the results including:
   - Flight statistics (duration, average voltage, average vibration)
   - Detected anomalies
   - Interactive graphs (battery voltage, vibration, motor outputs)
   - AI-generated technical analysis
   - Downloadable report

## How the Parser Works

The parser uses the `pymavlink` library to read ArduPilot .BIN files, which are binary telemetry logs generated by ArduPilot flight controllers.

### Parsing Process

1. **Connection Establishment**: Creates a MAVLink connection to the .BIN file using `mavutil.mavlink_connection()`

2. **Message Extraction**: Iterates through all messages in the log file and extracts relevant data based on message types:

   - **BAT (Battery)**: Extracts voltage (Volt) and current (Curr) measurements with timestamps
   - **VIBE (Vibration)**: Calculates vibration magnitude using the formula:
     ```
     magnitude = √(VibeX² + VibeY² + VibeZ²)
     ```
   - **GPS**: Extracts horizontal dilution of precision (HDOP) values
   - **RCOU (RC Output)**: Extracts PWM values for the first 4 motor channels (C1-C4)
   - **BARO (Barometer)**: Extracts altitude measurements

3. **Data Structure**: Organizes extracted data into a dictionary with arrays for each data type:
   ```python
   {
       'battery_voltage': [...],
       'battery_current': [...],
       'vibration': [...],
       'gps_hdop': [...],
       'motor_outputs': [[], [], [], []],  # 4 motors
       'altitude': [...],
       'timestamps': [...]
   }
   ```

4. **Time Conversion**: Converts microsecond timestamps (TimeUS) to seconds for easier analysis

## Anomaly Detection

The system implements three types of anomaly detection algorithms:

### 1. Voltage Sag Detection

**Purpose**: Identifies dangerous battery voltage drops that could lead to power loss

**Algorithm**:
- Compares each voltage reading against a threshold (default: 7.2V)
- Counts all instances where voltage falls below this safe operating threshold
- Records minimum voltage during sag events

**Significance**: Voltage sags can indicate:
- Battery degradation or damage
- Excessive current draw
- Imminent power failure risk

### 2. Vibration Spike Detection

**Purpose**: Detects abnormal mechanical vibrations that may indicate hardware issues

**Algorithm**:
- Uses statistical z-score analysis to identify outliers
- Calculation: `z = (vibration - mean) / standard_deviation`
- Flags vibrations with z-score > 3 (3 standard deviations above mean)
- Requires at least 2 data points and non-zero standard deviation

**Significance**: Vibration spikes can indicate:
- Loose propellers or hardware
- Motor bearing wear
- Structural damage or imbalance
- Improper propeller balancing

### 3. Motor Imbalance Detection

**Purpose**: Identifies motors operating at significantly different output levels

**Algorithm**:
- Calculates average PWM output for each motor
- Computes overall average across all motors
- Calculates percentage deviation for each motor
- Flags motors with deviation > 15% (default threshold)

**Significance**: Motor imbalances can indicate:
- Motor degradation or failure
- ESC (Electronic Speed Controller) issues
- Propeller damage
- Flight controller calibration problems

## Example Outputs

### Flight Statistics and Anomaly Detection Dashboard
![Flight Statistics](<img width="1808" height="656" alt="flight-statistics" src="https://github.com/user-attachments/assets/db54ea23-0251-44ba-aa85-2b333af85f00" />)


### Battery Voltage Graph
![Voltage Graph](<img width="1747" height="507" alt="image" src="https://github.com/user-attachments/assets/836eaddd-c742-4065-a47f-60963a39493a" />
)

### Vibration Analysis Graph
![Vibration Graph](<img width="1742" height="506" alt="image" src="https://github.com/user-attachments/assets/7b98ffb0-a4f5-4aa9-95dc-9944305c5ff4" />
)

### GPT5 Analysis Report
![AI Analysis](<img width="922" height="820" alt="image" src="https://github.com/user-attachments/assets/d35d3627-e800-47ed-930f-54aefc406ec2" />
)

## How the GPT-5 Integration Works

The application leverages OpenAI's GPT-5 model (`gpt-5-search-api-2025-10-14`) to provide expert-level flight analysis.

### Integration Architecture

1. **Data Preparation**:
   - Aggregates flight statistics, anomaly counts, and key metrics
   - Calculates summary statistics (min, max, average values)
   - Structures data into JSON format for AI processing

2. **Prompt Engineering**:
   - **System Prompt**: Defines the AI's role as an expert aerospace engineer specializing in drone telemetry analysis
   - **User Prompt**: Provides structured flight data and requests analysis in 5 specific categories:
     1. Overall Flight Assessment (with quality rating)
     2. Critical Issues Identified
     3. Technical Observations (battery, vibration, motors, stability)
     4. Maintenance Recommendations (prioritized by urgency)
     5. Risk Assessment (with flight worthiness status)

3. **API Communication**:
   ```python
   response = client.chat.completions.create(
       model="gpt-5-search-api-2025-10-14",
       messages=[
           {"role": "system", "content": system_prompt},
           {"role": "user", "content": user_prompt}
       ]
   )
   ```

4. **Response Processing**:
   - Extracts the AI-generated analysis from the API response
   - Displays formatted markdown in the Streamlit interface
   - Includes analysis in the downloadable report

5. **Key Features**:
   - **No Follow-up Questions**: Prompt explicitly instructs AI to provide definitive answers
   - **Structured Output**: Enforces consistent formatting across all analyses
   - **Technical Depth**: Leverages GPT-5's knowledge of aerospace engineering and drone systems
   - **Actionable Insights**: Focuses on practical maintenance recommendations and risk assessment

### Data Sent to AI

The integration sends a comprehensive summary including:
- Flight duration
- Battery statistics (min, max, average voltage)
- Vibration statistics (max, average vibration)
- Anomaly counts (voltage sags, vibration spikes)
- Motor analysis results (imbalance detection)
- Number of motors analyzed

### Error Handling

The system includes robust error handling:
- Try-catch blocks around API calls
- User-friendly error messages displayed in the interface
- Fallback to "AI analysis unavailable" if API fails
- Continues report generation even if AI analysis fails

## File Structure

```
drone-analyzer/
│
├── main.py                 # Main Streamlit application
├── bin_extraction.py       # .BIN file parser
├── anomaly_detection.py    # Anomaly detection algorithms
├── requirements.txt        # Python dependencies
├── README.md              # This file
```

## Technical Specifications

- **Supported File Format**: ArduPilot .BIN files
- **AI Model**: OpenAI GPT-5 (gpt-5-search-api-2025-10-14)
- **Visualization**: Plotly interactive graphs
- **Frontend**: Streamlit web application
- **Parsing Library**: pymavlink 2.4.49+
